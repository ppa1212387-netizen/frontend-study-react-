Next.js REST API 서버 구축 정리

React 프론트엔드 지원용 Next.js 백엔드 API  

- [Next.js 공식 사이트](https://nextjs.org/)  
- [Next.js Showcase](https://nextjs.org/showcase)  



1. 프로젝트 생성 및 환경 설정

```bash
pnpm create next-app backend-nextjs --typescript --eslint --app --no-src-dir --no-tailwind
패키지 설치
bash
코드 복사
# ORM
pnpm add @prisma/client
pnpm add -D prisma

# 인증
pnpm add bcryptjs jsonwebtoken
pnpm add -D @types/bcryptjs @types/jsonwebtoken

# OpenAI (선택)
pnpm add openai
환경 변수 (.env)

env
코드 복사
DATABASE_URL="file:./data/dev.db"
JWT_SECRET="랜덤 32자 이상 문자열"
OPENAI_API_KEY="your-api-key"
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:3001"
next.config.js

ts
코드 복사
const nextConfig = {
  reactStrictMode: true,
  env: {
    DATABASE_URL: process.env.DATABASE_URL,
    JWT_SECRET: process.env.JWT_SECRET,
    OPENAI_API_KEY: process.env.OPENAI_API_KEY,
    ALLOWED_ORIGINS: process.env.ALLOWED_ORIGINS,
  },
};
module.exports = nextConfig;


2. 데이터베이스 (Prisma)

ORM: 객체 ↔ DB 연결, SQL 대신 메서드 사용

ts
코드 복사
prisma.user.findUnique({ where: { id: 1 } });
장점: 생산성 ↑, 타입 안전성 ↑, 유지보수 용이

bash
코드 복사
pnpm prisma init --datasource-provider sqlite
pnpm prisma db push
pnpm prisma generate
pnpm prisma db push --force-reset # DB 초기화
Prisma Client (Singleton)

ts
코드 복사
import { PrismaClient } from '@prisma/client';
const globalForPrisma = global as any;
export const prisma = globalForPrisma.prisma ?? new PrismaClient();
if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;


3. 인증 시스템 (JWT)

JWT 구조: Header.Payload.Signature

동작: 로그인 → JWT 발급 → 클라이언트 Authorization 헤더 사용 → 서버 검증

ts
코드 복사
import jwt from 'jsonwebtoken';
const JWT_SECRET = process.env.JWT_SECRET || 'fallback';
export function generateToken(userId: number, email: string) {
  return jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: '24h' });
}



4. 미들웨어

Middleware: 요청 전 공통 처리 (인증, CORS, 로깅 등)

Route Handler: 실제 API 처리(CRUD 등)

구분	Middleware	Route Handler
위치	middleware.ts	app/api/.../route.ts
실행 시점	요청 직후	URL 매칭 시
환경	Edge Runtime	Node.js Runtime


5. CORS 설정

브라우저 보안 정책으로 다른 출처 요청 제한 → 허용 필요

http
코드 복사
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
