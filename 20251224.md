Next.js REST API 서버 구축 정리React 프론트엔드 지원용 Next.js 백엔드 API 구축 가이드입니다.공식 문서: Next.js 공식 사이트참고 사례: Next.js Showcase1. 프로젝트 생성 및 환경 설정프로젝트 초기화Bashpnpm create next-app backend-nextjs --typescript --eslint --app --no-src-dir --no-tailwind
패키지 설치Bash# ORM (Prisma)
pnpm add @prisma/client
pnpm add -D prisma

# 인증 (Auth)
pnpm add bcryptjs jsonwebtoken
pnpm add -D @types/bcryptjs @types/jsonwebtoken

# 외부 API (OpenAI 선택)
pnpm add openai
환경 변수 설정 (.env)코드 스니펫DATABASE_URL="file:./data/dev.db"
JWT_SECRET="your-super-secret-random-string"
OPENAI_API_KEY="your-api-key"
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:3001"
Next.js 설정 (next.config.js)JavaScript/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  env: {
    DATABASE_URL: process.env.DATABASE_URL,
    JWT_SECRET: process.env.JWT_SECRET,
    OPENAI_API_KEY: process.env.OPENAI_API_KEY,
    ALLOWED_ORIGINS: process.env.ALLOWED_ORIGINS,
  },
};

module.exports = nextConfig;
2. 데이터베이스 (Prisma ORM)ORM이란? 객체와 DB를 연결하여 SQL 쿼리 대신 메서드로 데이터를 조작하는 도구입니다.장점: 생산성 향상, 타입 안전성(Type Safety), 유지보수 용이.주요 명령어Bashpnpm prisma init --datasource-provider sqlite # 초기 설정
pnpm prisma db push                           # 스키마를 DB에 적용
pnpm prisma generate                         # Prisma Client 생성
pnpm prisma db push --force-reset            # DB 초기화 (주의)
Prisma Client (Singleton 패턴)Next.js의 Hot Reloading 시 커넥션이 쌓이는 것을 방지하기 위해 싱글톤 패턴을 사용합니다.TypeScriptimport { PrismaClient } from '@prisma/client';

const globalForPrisma = global as any;
export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;
3. 인증 시스템 (JWT)JWT 구조: Header.Payload.Signature동작 방식: 로그인 성공 → 서버가 JWT 발급 → 클라이언트는 Authorization 헤더에 담아 요청 → 서버 검증토큰 생성 함수TypeScriptimport jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'fallback';

export function generateToken(userId: number, email: string) {
  return jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: '24h' });
}
4. 미들웨어 vs 라우트 핸들러구분MiddlewareRoute Handler위치middleware.ts (루트)app/api/.../route.ts실행 시점요청 직후 (모든 요청)특정 URL 매칭 시환경Edge RuntimeNode.js Runtime용도인증 확인, 로깅, 리다이렉트실제 비즈니스 로직, CRUD5. CORS 설정브라우저의 보안 정책상 다른 도메인(출처)의 API 호출은 기본적으로 차단됩니다. 이를 허용하기 위해 응답 헤더 설정이 필요합니다.주요 헤더HTTPAccess-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
