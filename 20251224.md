Next.js REST API ì„œë²„ êµ¬ì¶• ê°€ì´ë“œ

React í”„ë¡ íŠ¸ì—”ë“œ ì§€ì›ìš© Next.js ë°±ì—”ë“œ API êµ¬ì¶• ì™„ë²½ ê°€ì´ë“œ

ì°¸ê³  ìë£Œ

Next.js ê³µì‹ ì‚¬ì´íŠ¸
Next.js Showcase


1. í”„ë¡œì íŠ¸ ìƒì„± ë° í™˜ê²½ ì„¤ì •
í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
bashpnpm create next-app backend-nextjs \
  --typescript \
  --eslint \
  --app \
  --no-src-dir \
  --no-tailwind
íŒ¨í‚¤ì§€ ì„¤ì¹˜
ORM (Prisma)
bashpnpm add @prisma/client
pnpm add -D prisma
ì¸ì¦ (JWT, bcrypt)
bashpnpm add bcryptjs jsonwebtoken
pnpm add -D @types/bcryptjs @types/jsonwebtoken
OpenAI (ì„ íƒì‚¬í•­)
bashpnpm add openai
í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
.env íŒŒì¼ ìƒì„±:
envDATABASE_URL="file:./data/dev.db"
JWT_SECRET="ëœë¤_32ì_ì´ìƒ_ë¬¸ìì—´_ìƒì„±í•˜ê¸°"
OPENAI_API_KEY="your-api-key"
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:3001"
Next.js ì„¤ì •
next.config.js:
typescriptconst nextConfig = {
  reactStrictMode: true,
  env: {
    DATABASE_URL: process.env.DATABASE_URL,
    JWT_SECRET: process.env.JWT_SECRET,
    OPENAI_API_KEY: process.env.OPENAI_API_KEY,
    ALLOWED_ORIGINS: process.env.ALLOWED_ORIGINS,
  },
};

module.exports = nextConfig;

2. ë°ì´í„°ë² ì´ìŠ¤ (Prisma ORM)
ORMì´ë€?
ORM (Object-Relational Mapping): ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ì—¬ SQL ëŒ€ì‹  ë©”ì„œë“œë¡œ ë°ì´í„° ì¡°ì‘
typescript// SQL ì—†ì´ ì´ë ‡ê²Œ ì‚¬ìš©
prisma.user.findUnique({ where: { id: 1 } });
ORMì˜ ì¥ì 
ì¥ì ì„¤ëª…ğŸš€ ìƒì‚°ì„± í–¥ìƒSQL ì‘ì„± ì—†ì´ ì§ê´€ì ì¸ ì½”ë“œë¡œ ê°œë°œğŸ”’ íƒ€ì… ì•ˆì „ì„±TypeScript ìë™ ì™„ì„± ë° íƒ€ì… ì²´í¬ğŸ› ï¸ ìœ ì§€ë³´ìˆ˜ ìš©ì´ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìë™ ê´€ë¦¬
Prisma ì´ˆê¸°í™” ë° ì‹¤í–‰
bash# ì´ˆê¸°í™” (SQLite ì‚¬ìš©)
pnpm prisma init --datasource-provider sqlite

# ìŠ¤í‚¤ë§ˆë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜
pnpm prisma db push

# Prisma Client ìƒì„±
pnpm prisma generate

# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (ì£¼ì˜: ëª¨ë“  ë°ì´í„° ì‚­ì œ)
pnpm prisma db push --force-reset
Prisma Client ì„¤ì • (Singleton íŒ¨í„´)
lib/prisma.ts:
typescriptimport { PrismaClient } from '@prisma/client';

const globalForPrisma = global as any;

export const prisma = 
  globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma;
}
```

> âš ï¸ **Singleton íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ **: ê°œë°œ í™˜ê²½ì—ì„œ Hot Reload ì‹œ PrismaClient ì¸ìŠ¤í„´ìŠ¤ê°€ ì¤‘ë³µ ìƒì„±ë˜ëŠ” ê²ƒì„ ë°©ì§€

---

## 3. ì¸ì¦ ì‹œìŠ¤í…œ (JWT)

### JWT êµ¬ì¡°
```
Header.Payload.Signature
```

| êµ¬ì„± ìš”ì†Œ | ë‚´ìš© |
|----------|------|
| **Header** | í† í° íƒ€ì… ë° ì•Œê³ ë¦¬ì¦˜ ì •ë³´ |
| **Payload** | ì‚¬ìš©ì ë°ì´í„° (userId, email ë“±) |
| **Signature** | ìœ„ë³€ì¡° ë°©ì§€ìš© ì„œëª… |

### JWT ë™ì‘ íë¦„
```
1. ë¡œê·¸ì¸ ìš”ì²­
   â†“
2. ì„œë²„: JWT ë°œê¸‰
   â†“
3. í´ë¼ì´ì–¸íŠ¸: Authorization í—¤ë”ì— JWT ì €ì¥
   â†“
4. ì´í›„ ìš”ì²­ë§ˆë‹¤ JWT ì „ì†¡
   â†“
5. ì„œë²„: JWT ê²€ì¦ í›„ ì²˜ë¦¬
JWT í† í° ìƒì„± í•¨ìˆ˜
lib/auth.ts:
typescriptimport jwt from 'jsonwebtoken';

const JWT_SECRET = process.env.JWT_SECRET || 'fallback';

export function generateToken(userId: number, email: string) {
  return jwt.sign(
    { userId, email },
    JWT_SECRET,
    { expiresIn: '24h' }
  );
}

## 4. ë¯¸ë“¤ì›¨ì–´ì™€ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬

### ê°œë… ì •ë¦¬

**Middleware**: ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ì–´ ê³µí†µ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹  
**Route Handler**: ì‹¤ì œ API ë¡œì§ì„ ì²˜ë¦¬ (CRUD ë“±)

### ì£¼ìš” ì°¨ì´ì 

**Middleware (`middleware.ts`)**
- ì‹¤í–‰ ì‹œì : ìš”ì²­ ì§í›„ (ëª¨ë“  ìš”ì²­)
- ìš©ë„: ì¸ì¦, CORS, ë¡œê¹…
- ëŸ°íƒ€ì„: Edge Runtime

**Route Handler (`app/api/.../route.ts`)**
- ì‹¤í–‰ ì‹œì : URL ë§¤ì¹­ ì‹œ
- ìš©ë„: CRUD, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- ëŸ°íƒ€ì„: Node.js Runtime

### ì—­í•  ì˜ˆì‹œ
```typescript
// Middleware: ì¸ì¦ ì²´í¬
if (!token) return NextResponse.json({ error: 'Unauthorized' });

// Route Handler: ì‹¤ì œ ë°ì´í„° ì²˜ë¦¬
const user = await prisma.user.findUnique({ where: { id } });
```

---

## 5. CORS ì„¤ì •

### CORSë€?

**Cross-Origin Resource Sharing**: ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ë‹¤ë¥¸ ì¶œì²˜(ë„ë©”ì¸)ì˜ ë¦¬ì†ŒìŠ¤ ìš”ì²­ì„ ì œí•œí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜
```
í”„ë¡ íŠ¸ì—”ë“œ (localhost:3000)
    â†“ ìš”ì²­
ë°±ì—”ë“œ (localhost:4000)
    â†“ CORS í—ˆìš© í•„ìš”
í•„ìˆ˜ CORS í—¤ë”
httpAccess-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
ì˜ˆì œ ì½”ë“œ
typescriptconst headers = {
  'Access-Control-Allow-Origin': 'http://localhost:3000',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

return NextResponse.json({ data }, { headers });
